<?phpfunction make_thumbnail($image,$outimage){if (!$max_width)	$max_width = 150;if (!$max_height)	$max_height = 100;	$size = GetImageSize($image);$width = $size[0];$height = $size[1];$x_ratio = $max_width/$width;$y_ratio = $max_height/$height;if (($width <= $max_width) && ($height <= $max_height))	{	$tn_width = $width;	$tn_height = $height;	}elseif (($x_ratio * $height) < $max_height)	{	$tn_height = round($x_ratio * $height);	$tn_width = $max_width;	}else	{	$tn_width = round($y_ratio * $width);	$tn_height = $max_height;	}$src = ImageCreateFromJpeg($image);$dst = ImageCreate($tn_width,$tn_height);$process = ImageCopyResized($dst,$src,0,0,0,0,$tn_width,$tn_height,$width,$height);$fp = fopen("$outimage","w");$newfile = ImageJpeg($dst,"$outimage",-1);fclose($fp);ImageDestroy($src);ImageDestroy($dst);}#############################################function do_photo($folder,$imgname)	{	global $phopath;	global $max_width;	global $max_height;	global $screen_w;	global $screen_h;		list($width, $height) = getimagesize($phopath."/".$folder."/".$imgname);		if ($height > $max_height) {		$ratio = $max_height/$height;		$width = round($width*$ratio);		$height = round($height*$ratio);	}	if ($width > $max_width) {		$ratio = $max_width/$width;		$width = round($width*$ratio);		$height = round($height*$ratio);	}			#echo "<p>".$phopath.'/'.$folder."/".$imgname."</p>";	#$win_width=$width+20; $win_height=$height+24;	$win_width = $screen_w; $win_height = $screen_h;	echo "<a href=\"#\" onclick=\"popupwindow('viewphoto.php?source=$phopath/$folder/$imgname&width=$width&height=$height','$win_width','$win_height','no');return false;\"><img src=\"$phopath/$folder/tnail/$imgname\" border=\"0\" hspace=\"4\" vspace=\"4\"></a>\n";	}#############################################function do_clie_photo($folder,$imgname,$item_num)	{	global $phopath;		$max_width = 320;	$max_height = 480;			list($width, $height) = getimagesize($phopath."/".$folder."/".$imgname);	list($twidth, $theight) = getimagesize($phopath."/".$folder."/tnail/".$imgname);	$twidth = round($twidth/2);	$theight = round($theight/2);	if ($height > $max_height) {		$ratio = $max_height/$height;		$width = round($width*$ratio);		$height = round($height*$ratio);	}	if ($width > $max_width) {		$ratio = $max_width/$width;		$width = round($width*$ratio);		$height = round($height*$ratio);	}			echo "<a href=\"clie.php?mode=slideshow&folder=$folder&item_num=$item_num\"><img src=\"$phopath/$folder/tnail/$imgname\" width=\"$twidth\" height=\"$theight\"></a>\n";	}#############################################?>